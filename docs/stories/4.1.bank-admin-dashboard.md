# Story 4.1: Bank Admin Dashboard & Queue Overview

## Status
Ready for Development

## Story

**As a** bank administrator,
**I want** to see a summary dashboard showing applications, offers, and conversion metrics,
**so that** I understand my bank's activity at a glance.

## Acceptance Criteria

1. GET /api/bank/dashboard returns summary metrics for authenticated bank
2. Metrics: Applications Received Today, Applications Received (All), Offers Submitted, Offers Accepted by Borrowers, Conversion Rate, Average Time to Offer
3. Time period filters: Today, Last 7 days, Last 30 days, Custom
4. Charts (optional): trend line, conversion funnel
5. Quick links: View Application Queue, View Rate Cards, Submit Offer
6. Last updated timestamp
7. Authenticated bank sees only their own metrics
8. Response time: <500ms
9. Integration test: submit applications, verify dashboard count matches

## Tasks / Subtasks

- [ ] Task 1: Create Dashboard Metrics DTOs (AC: 2)
  - [ ] Create BankDashboardMetrics DTO (src/main/java/com/creditapp/bank/dto/BankDashboardMetrics.java)
    - Fields: applicationsReceivedToday (Integer), applicationsReceivedAll (Integer), offersSubmitted (Integer), offersAccepted (Integer), conversionRate (BigDecimal), averageTimeToOffer (Integer days), lastUpdated (LocalDateTime)
  - [ ] Create BankDashboardResponse DTO
    - Fields: metrics, quickLinks (List<QuickLink>), selectedTimePeriod (String)

- [ ] Task 2: Create Dashboard Metrics Service (AC: 1, 2, 7, 8)
  - [ ] Create BankDashboardService (src/main/java/com/creditapp/bank/service/BankDashboardService.java)
    - Method: getDashboardMetrics(UUID bankId, String timePeriod) returns BankDashboardMetrics
      - Query applications where offer from bankId exists
      - Filter by time period: TODAY, LAST_7_DAYS, LAST_30_DAYS, CUSTOM (with date range)
      - Calculate: applications count, offers count, accepted count, conversion rate, average time
      - Verify bankId ownership (AC7)
      - Return with lastUpdated timestamp (AC6)
    - Measure response time, ensure <500ms (AC8)

- [ ] Task 3: Create Dashboard Controller (AC: 1, 3, 7)
  - [ ] Create BankDashboardController (src/main/java/com/creditapp/bank/controller/BankDashboardController.java)
    - GET /api/bank/dashboard
      - @PreAuthorize("hasAuthority('BANK_ADMIN')")
      - Query parameters: timePeriod (default TODAY), dateStart (optional), dateEnd (optional)
      - Extract bankId from SecurityContext
      - Call BankDashboardService.getDashboardMetrics()
      - Return BankDashboardResponse with 200 OK

- [ ] Task 4: Create Quick Links (AC: 5)
  - [ ] Add quickLinks to response: View Application Queue, View Rate Cards, Submit Offer
    - Include URLs for each link

- [ ] Task 5: Create Unit Tests (AC: 2, 8)
  - [ ] Test dashboard metrics calculation
  - [ ] Test time period filtering
  - [ ] Test response time <500ms
  - [ ] Test bank ownership verification

- [ ] Task 6: Create Integration Tests (AC: 1, 9)
  - [ ] Create 5 applications from different borrowers
  - [ ] Verify dashboard count matches
  - [ ] Submit offers, verify counts updated
  - [ ] Accept offers, verify conversion rate updated

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Initial story draft - Bank Admin Dashboard | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*To be completed by development agent*

### Debug Log References
*To be completed by development agent*

### Completion Notes
*To be completed by development agent*

### File List
*To be completed by development agent*

## QA Results

*To be completed by QA agent after story is implemented*
