# Story 2.10: User Help Content & Guidance

## Status
Ready for Development

## Story

**As a** borrower,
**I want** to access helpful guidance and FAQs throughout the application process,
**so that** I can understand requirements and make informed decisions.

## Acceptance Criteria

1. Help content API: GET /api/borrower/help/{topic} returns help article
2. Topics: loan-types, application-requirements, document-checklist, rate-preference, submission-tips
3. Content includes: title, description, steps/sections, FAQs, examples
4. Content is versioned (support updates without breaking changes)
5. Content is localized (English required, other languages optional)
6. Help content is CMS-backed (database, not hardcoded)
7. Help articles can include embedded calculator links
8. Admin can update help content via admin panel (Story 4.7)
9. Integration test: retrieve help content, verify completeness

## Tasks / Subtasks

- [ ] Task 1: Design Help Content Schema (AC: 1, 3, 4, 6)
  - [ ] Create HelpArticle table in database
    - Columns: id (UUID), topic (VARCHAR UNIQUE), version (INT), title (VARCHAR), description (TEXT), content (JSON or TEXT), language (VARCHAR, default 'en'), status (PUBLISHED, DRAFT), createdAt, updatedAt, createdBy (UUID)
  - [ ] Create HelpSection table (optional, for structured content)
    - Columns: id (UUID), articleId (UUID FK), sectionNumber (INT), heading (VARCHAR), content (TEXT), displayOrder (INT)
  - [ ] Create HelpFAQ table
    - Columns: id (UUID), articleId (UUID FK), question (VARCHAR), answer (TEXT), order (INT)
  - [ ] Create database migration to add tables

- [ ] Task 2: Create Help Content JPA Entities (AC: 4, 6)
  - [ ] Create HelpArticle entity (src/main/java/com/creditapp/shared/model/HelpArticle.java)
    - Fields: id, topic, version, title, description, content, language, status, createdAt, updatedAt, createdBy
    - @Entity, @Table(name = "help_articles")
    - Unique constraint on (topic, language)
  - [ ] Create HelpSection entity (src/main/java/com/creditapp/shared/model/HelpSection.java)
    - Fields: id, articleId, sectionNumber, heading, content, displayOrder
    - @Entity, @OneToMany relationship to HelpArticle
  - [ ] Create HelpFAQ entity (src/main/java/com/creditapp/shared/model/HelpFAQ.java)
    - Fields: id, articleId, question, answer, order
    - @Entity, @OneToMany relationship to HelpArticle
  - [ ] Create HelpArticleStatus enum: PUBLISHED, DRAFT, ARCHIVED

- [ ] Task 3: Create Help Content DTOs (AC: 1, 3, 5)
  - [ ] Create HelpArticleDTO (src/main/java/com/creditapp/borrower/dto/HelpArticleDTO.java)
    - Fields: id, topic, title, description, content, version, language, sections (List<HelpSectionDTO>), faqs (List<HelpFAQDTO>), lastUpdated
  - [ ] Create HelpSectionDTO (src/main/java/com/creditapp/borrower/dto/HelpSectionDTO.java)
    - Fields: heading, content, order
  - [ ] Create HelpFAQDTO (src/main/java/com/creditapp/borrower/dto/HelpFAQDTO.java)
    - Fields: question, answer, order
  - [ ] Create HelpArticleListDTO
    - Fields: topic, title, description, language
    - Used for listing available help topics

- [ ] Task 4: Create Help Content Repository (AC: 6)
  - [ ] Create HelpArticleRepository (src/main/java/com/creditapp/shared/repository/HelpArticleRepository.java)
    - Extends JpaRepository<HelpArticle, UUID>
    - Method: findByTopicAndLanguageAndStatus(String topic, String language, HelpArticleStatus status) returns Optional<HelpArticle>
    - Method: findByLanguageAndStatus(String language, HelpArticleStatus status, Pageable pageable) returns Page<HelpArticle>
    - Method: findByTopic(String topic) returns List<HelpArticle> (all versions)

- [ ] Task 5: Create Help Content Service (AC: 1, 4, 5)
  - [ ] Create HelpContentService (src/main/java/com/creditapp/shared/service/HelpContentService.java)
    - Method: getHelpArticle(String topic, String language) returns HelpArticleDTO
      - Query HelpArticleRepository for topic and language
      - Default to 'en' if language not available
      - Throw HelpArticleNotFoundException if not found
      - Return HelpArticleDTO with sections and FAQs
    - Method: listHelpTopics(String language) returns List<HelpArticleListDTO>
      - Query all published articles for language
      - Return list of available topics
    - Method: getHelpArticlesByTopic(String topic) returns List<HelpArticleDTO> (all versions)
      - Used for version history (admin feature)
  - [ ] Unit tests: mock repository, test article retrieval

- [ ] Task 6: Create Help Content REST Endpoints (AC: 1, 2, 5)
  - [ ] Create HelpContentController (src/main/java/com/creditapp/borrower/controller/HelpContentController.java)
    - GET /api/help/topics
      - Query parameter: language (default 'en')
      - Call HelpContentService.listHelpTopics()
      - Return List<HelpArticleListDTO> with 200 OK
      - permitAll (public endpoint)
    - GET /api/help/{topic}
      - Query parameter: language (default 'en')
      - Call HelpContentService.getHelpArticle(topic, language)
      - Return HelpArticleDTO with 200 OK
      - Error handling: 404 Not Found
      - permitAll (public endpoint)
  - [ ] Unit tests: mock service, test success and error paths
  - [ ] Integration tests: real HTTP requests, verify content returned

- [ ] Task 7: Seed Help Content (AC: 2, 3, 8)
  - [ ] Create data migration or seed script (src/main/resources/db/migration/V*.sql or src/main/resources/db/seed-help-content.sql)
    - INSERT help articles for topics: loan-types, application-requirements, document-checklist, rate-preference, submission-tips
    - Each article includes: title, description, sections, FAQs
  - [ ] Example help articles:
    - **loan-types**: Explains PERSONAL, HOME, AUTO, etc.
    - **application-requirements**: Documents, income verification, employment info
    - **document-checklist**: List of required documents for each loan type
    - **rate-preference**: Explains FIXED, VARIABLE, EITHER
    - **submission-tips**: Best practices for successful applications
  - [ ] Include FAQs for each topic

- [ ] Task 8: Create Caching Layer (optional for performance) (AC: 4)
  - [ ] Cache help articles using Spring Cache
    - @Cacheable("helpArticles") on getHelpArticle method
    - Cache key: topic:language
    - TTL: 24 hours (help content doesn't change frequently)
  - [ ] Optional: Use Redis for distributed caching

- [ ] Task 9: Create Tests (AC: 1, 9)
  - [ ] Unit test: retrieve published help article, verify content returned
  - [ ] Unit test: retrieve with non-existent topic, verify 404 error
  - [ ] Unit test: retrieve with alternative language, verify default to English
  - [ ] Unit test: list all help topics, verify count
  - [ ] Unit test: help article includes sections and FAQs
  - [ ] Integration test: GET /api/help/loan-types, verify content structure
  - [ ] Integration test: GET /api/help/topics, verify all topics listed
  - [ ] Integration test: retrieve help article, verify caching works
  - [ ] Integration test: verify help content is accessible to borrowers

- [ ] Task 10: Update API Documentation (AC: 1, 2, 3)
  - [ ] Document GET /api/help/topics
    - Response example: List of help topics
  - [ ] Document GET /api/help/{topic}
    - Path parameter: topic (loan-types, application-requirements, etc.)
    - Query parameter: language (default 'en')
    - Response example: HelpArticleDTO with sections and FAQs
    - Error responses: 404

## Dev Notes

### Previous Story Dependencies
- **Story 2.1-2.9**: Help content references and guides for borrower workflow

### Technology Stack
- **ORM**: Spring Data JPA for help content persistence
- **Caching**: Spring Cache / Redis (optional)
- **Localization**: Language parameter in API

### Key Design Notes
- Help content is versioned (supports updates)
- Multi-language support with English default
- Content is published/draft (admin controls visibility)
- Help articles include structured sections and FAQs
- Caching reduces database load for frequently accessed content
- Content is CMS-backed (database-driven, updatable by admin)

### Content Structure
`
HelpArticle (topic: "loan-types")
 Sections
    Section 1: "Personal Loans"
    Section 2: "Home Loans"
    Section 3: "Auto Loans"
 FAQs
     "What is a personal loan?"
     "How long is approval?"
     "Can I prepay?"
`

## Testing

### Testing Checklist
- [ ] Get help article for loan-types, verify content returned
- [ ] Get help article for application-requirements, verify document checklist
- [ ] Get help article with non-existent topic, verify 404 error
- [ ] Get help article in different language, verify returned or default to English
- [ ] List help topics, verify all topics (loan-types, requirements, etc.)
- [ ] Verify help article includes sections with content
- [ ] Verify help article includes FAQs with questions and answers
- [ ] Help article is publicly accessible (no authentication required)
- [ ] Help content cached, verify subsequent requests faster
- [ ] All tests pass with \mvn clean test\
- [ ] Code coverage >80%

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Initial story draft - User Help Content & Guidance | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*To be completed by development agent*

### Debug Log References
*To be completed by development agent*

### Completion Notes
*To be completed by development agent*

### File List
*To be completed by development agent*

## QA Results

*To be completed by QA agent after story is implemented*
