# Story 2.7: Status Tracking Dashboard

## Status
Ready for Development

## Story

**As a** borrower,
**I want** to see a visual dashboard showing the status and progress of my applications,
**so that** I can understand where each application stands in the review process.

## Acceptance Criteria

1. GET /api/borrower/dashboard returns application status summary
2. Dashboard data: total applications, draft count, submitted count, offers received count, accepted count
3. Status breakdown pie chart data: count per status (DRAFT, SUBMITTED, UNDER_REVIEW, OFFERS_AVAILABLE, ACCEPTED, REJECTED, COMPLETED)
4. Recent activity timeline: last 5 status changes across all borrower applications
5. Average offer rate across offers (if any received)
6. Next action prompts: "You have 3 DRAFT applications ready to submit"
7. No sensitive data exposed (bank details, offer amounts per bank)
8. Response time <50ms (cache-friendly)
9. Integration test: verify dashboard data aggregation

## Tasks / Subtasks

- [ ] Task 1: Create Dashboard DTOs (AC: 2, 3, 4, 5, 6, 7)
  - [ ] Create DashboardResponse DTO (src/main/java/com/creditapp/borrower/dto/DashboardResponse.java)
    - Fields: totalApplications, draftCount, submittedCount, offersReceivedCount, acceptedCount
    - statusBreakdown (Map<ApplicationStatus, Integer>)
    - recentActivity (List<ActivityEntry>)
    - averageOfferRate (BigDecimal, nullable)
    - nextActionPrompts (List<String>)
    - lastUpdated (LocalDateTime)
  - [ ] Create ActivityEntry DTO
    - Fields: applicationId, loanType, loanAmount, oldStatus, newStatus, changedAt, daysAgo
  - [ ] Ensure no sensitive data in response (encrypt or filter)

- [ ] Task 2: Create Dashboard Service (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Create DashboardService (src/main/java/com/creditapp/borrower/service/DashboardService.java)
    - Method: getDashboard(UUID borrowerId) returns DashboardResponse
      - Query ApplicationRepository for all borrower applications
      - Count by status
      - Calculate statistics
      - Fetch recent activity (5 recent status changes)
      - Generate action prompts
      - Return aggregated response
  - [ ] Unit tests: mock repositories, test aggregation logic

- [ ] Task 3: Create Dashboard Endpoint (AC: 1, 8)
  - [ ] Add GET endpoint to BorrowerApplicationController or create DashboardController
    - Endpoint: GET /api/borrower/dashboard
    - @PreAuthorize("hasAuthority('BORROWER')")
    - Extract borrowerId from SecurityContext
    - Call DashboardService.getDashboard(borrowerId)
    - Return DashboardResponse with 200 OK
    - Add HTTP caching: Cache-Control: max-age=300 (5 minutes)
  - [ ] Unit tests: mock service, verify response format
  - [ ] Integration tests: verify data accuracy

- [ ] Task 4: Add Caching (AC: 8)
  - [ ] Add @Cacheable("borrowerDashboard") to getDashboard method
    - Cache key: borrowerId
    - TTL: 5 minutes
    - Invalidate on application status change (story 2.5 event listener)

- [ ] Task 5: Create Tests (AC: 1, 9)
  - [ ] Unit test: getDashboard aggregates counts correctly
  - [ ] Unit test: status breakdown includes all statuses
  - [ ] Unit test: recent activity returns up to 5 entries
  - [ ] Unit test: action prompts generated based on status counts
  - [ ] Unit test: averageOfferRate calculated correctly
  - [ ] Integration test: create multiple applications, query dashboard
  - [ ] Integration test: submit application, verify counts update
  - [ ] Integration test: verify response time <50ms

- [ ] Task 6: Update API Documentation (AC: 1, 2, 3)
  - [ ] Document GET /api/borrower/dashboard
    - Response example with all fields
    - Status breakdown example
    - Recent activity example

## Dev Notes

### Previous Story Dependencies
- **Story 2.1, 2.2, 2.5**: Application status and history data

### Key Design Notes
- Dashboard aggregates data from multiple applications
- Status breakdown shows count per status
- Recent activity pulls from ApplicationHistory table
- Caching reduces database load
- Action prompts help guide borrower next steps

## Testing

### Testing Checklist
- [ ] Dashboard totalApplications count correct
- [ ] Draft count matches DRAFT status applications
- [ ] Status breakdown includes all statuses
- [ ] Recent activity returns up to 5 entries sorted by date
- [ ] Average offer rate calculated from offers (story 3.x)
- [ ] Action prompts generated based on status counts
- [ ] Dashboard response includes lastUpdated timestamp
- [ ] Caching works: second request <5ms
- [ ] Cache invalidated on application status change
- [ ] No sensitive data in response
- [ ] Response time <50ms
- [ ] All tests pass with mvn clean test
- [ ] Code coverage >80%

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Initial story draft - Status Tracking Dashboard | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*To be completed by development agent*

### Debug Log References
*To be completed by development agent*

### Completion Notes
*To be completed by development agent*

### File List
*To be completed by development agent*

## QA Results

*To be completed by QA agent after story is implemented*
