# Story 2.6: List Applications API

## Status
Ready for Development

## Story

**As a** borrower,
**I want** to view a paginated list of all my applications with status summary,
**so that** I can see my application portfolio and track multiple applications at once.

## Acceptance Criteria

1. GET /api/borrower/applications returns paginated list of borrower's applications
2. Query parameters: page (default 0), size (default 10), sort (status|createdAt), status (filter optional)
3. Response includes: ApplicationDTO list with pagination metadata (total, page, size, totalPages)
4. Applications sorted by createdAt DESC (newest first) by default
5. Only borrower's own applications returned (filtered by borrowerId)
6. Summary card for each: id, loanType, loanAmount, status, createdAt, updatedAt
7. Status filter: show DRAFT, SUBMITTED, OFFERS_AVAILABLE, ACCEPTED, etc.
8. Empty list returns 200 OK with empty array (no 404)
9. Performance: query <100ms for p95 (use index on borrower_id, created_at)
10. Integration test: create multiple applications, list with pagination and filters

## Tasks / Subtasks

- [ ] Task 1: Create Application List DTO (AC: 6, 7)
  - [ ] Create ApplicationSummaryDTO (src/main/java/com/creditapp/borrower/dto/ApplicationSummaryDTO.java)
    - Fields: id, loanType, loanAmount, status, createdAt, updatedAt
    - Minimal data for list view (no details, history)
  - [ ] Create PageResponse<T> wrapper (src/main/java/com/creditapp/shared/dto/PageResponse.java)
    - Fields: content (List<T>), currentPage, pageSize, totalElements, totalPages, hasNext, hasPrevious
    - Generic wrapper for all paginated responses

- [ ] Task 2: Extend Application Service (AC: 2, 4, 5, 7)
  - [ ] Extend ApplicationService with listApplications method
    - Method: listApplications(UUID borrowerId, Pageable pageable, Optional<ApplicationStatus> statusFilter) returns Page<ApplicationDTO>
    - Verify borrowerId (implicit in method param)
    - Query ApplicationRepository with pageable
    - Apply status filter if provided
    - Order by createdAt DESC by default
    - Return Page<ApplicationDTO>
  - [ ] Update ApplicationRepository if needed
    - Verify query uses index on (borrower_id, created_at)
  - [ ] Unit tests: mock repository, test filtering and pagination

- [ ] Task 3: Create List Endpoint in Controller (AC: 1, 2, 5, 8)
  - [ ] Add GET endpoint to BorrowerApplicationController
    - Endpoint: GET /api/borrower/applications
    - @PreAuthorize("hasAuthority('BORROWER')")
    - Extract borrowerId from SecurityContext
    - Query parameters: page (default 0), size (default 10), status (optional), sort (default "createdAt,desc")
    - Call ApplicationService.listApplications(borrowerId, pageable, statusFilter)
    - Return PageResponse<ApplicationSummaryDTO> with 200 OK
    - Return 200 OK with empty list if no applications (not 404)
  - [ ] Unit tests: mock service, test pagination
  - [ ] Integration tests: full pagination flow

- [ ] Task 4: Create Tests (AC: 8, 9, 10)
  - [ ] Unit test: list borrower's applications, verify only their own returned
  - [ ] Unit test: pagination page 0 size 5, verify 5 results
  - [ ] Unit test: pagination page 1, verify next page results
  - [ ] Unit test: status filter DRAFT, verify only DRAFT returned
  - [ ] Unit test: empty list returns 200 OK with empty array
  - [ ] Unit test: sort by createdAt DESC (default)
  - [ ] Integration test: create 15 applications, list first page (10), verify pagination info
  - [ ] Integration test: list with status filter, verify filtered results
  - [ ] Integration test: verify query performance <100ms

- [ ] Task 5: Update API Documentation (AC: 1, 2, 3)
  - [ ] Document GET /api/borrower/applications
    - Query parameters: page, size, status (DRAFT, SUBMITTED, OFFERS_AVAILABLE, ACCEPTED, REJECTED, COMPLETED)
    - Response example: PageResponse<ApplicationSummaryDTO>
    - Pagination metadata example

## Dev Notes

### Previous Story Dependencies
- **Story 2.1, 2.2**: Application service and DTOs

### Key Design Notes
- Page numbering: 0-based (page 0 is first page)
- Default sorting: createdAt DESC (newest first)
- Status filter: optional, comma-separated for multiple values
- Query should use index on (borrower_id, created_at) for performance

## Testing

### Testing Checklist
- [ ] List applications for borrower, verify only their applications
- [ ] Pagination page 0 size 10, verify 10 results
- [ ] Pagination page 1, verify next 10 results
- [ ] Filter by status=DRAFT, verify only DRAFT applications
- [ ] Filter by multiple statuses, verify filtered results
- [ ] Empty list returns 200 OK with empty array
- [ ] Verify totalPages calculated correctly
- [ ] Verify hasNext and hasPrevious flags
- [ ] Sort order is createdAt DESC (newest first)
- [ ] Query performance <100ms for p95
- [ ] All tests pass with mvn clean test
- [ ] Code coverage >80%

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Initial story draft - List Applications API | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*To be completed by development agent*

### Debug Log References
*To be completed by development agent*

### Completion Notes
*To be completed by development agent*

### File List
*To be completed by development agent*

## QA Results

*To be completed by QA agent after story is implemented*
