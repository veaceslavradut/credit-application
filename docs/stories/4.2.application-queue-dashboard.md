# Story 4.2: Application Queue Dashboard

## Status
Ready for Development

## Story

**As a** bank administrator,
**I want** to see a paginated queue of applications for my bank with filtering and search,
**so that** I can quickly find applications to review.

## Acceptance Criteria

1. GET /api/bank/applications/queue returns paginated list of applications
2. Page size: 20 items, support page parameter for pagination
3. Filters: Application Status (SUBMITTED/VIEWED/OFFER_RECEIVED/ACCEPTED/WITHDRAWN), Loan Type, Application Date Range, Loan Amount Range
4. Sort options: Newest First, Oldest First, Amount (Low to High), Amount (High to Low), Status
5. Search: by Application ID, Borrower Email, Borrower Name
6. "New applications" badge shows count of SUBMITTED (not VIEWED) applications
7. Display: Application ID, Borrower Name, Loan Type, Amount, Status, Applied Date
8. Mark as VIEWED when bank views application (AC2 of 4.3)
9. Response time: <200ms
10. Support 500+ applications without performance degradation

## Tasks / Subtasks

- [ ] Task 1: Create Queue DTOs
  - [ ] Create ApplicationQueueItem DTO (id, borrowerName, loanType, amount, status, appliedDate)
  - [ ] Create ApplicationQueueResponse DTO with paginated results
  - [ ] Create QueueFilter DTO (statuses, loanTypes, dateRange, amountRange, sortBy)

- [ ] Task 2: Create Queue Service
  - [ ] Create BankApplicationQueueService
    - Method: getApplicationQueue(UUID bankId, QueueFilter filter, int page, int pageSize)
      - Filter applications where offer from bankId exists
      - Apply all filters (status, loan type, date range, amount range)
      - Sort by selected option
      - Apply pagination (page, pageSize=20)
      - Ensure <200ms response time
      - Return paginated ApplicationQueueResponse

- [ ] Task 3: Create Queue Controller
  - [ ] Create BankApplicationQueueController
    - GET /api/bank/applications/queue
      - Query params: page (default 0), status[], loanType[], dateFrom, dateTo, amountFrom, amountTo, sortBy (default NEWEST_FIRST)
      - Search params: applicationId, borrowerEmail, borrowerName
      - Extract bankId from SecurityContext
      - Call QueueService
      - Return paginated response with 200 OK

- [ ] Task 4: Search Implementation
  - [ ] Add search capability to QueueService
    - Search by exact Application ID
    - Search by Borrower Email (case-insensitive partial match)
    - Search by Borrower Name (case-insensitive partial match)
    - Return search results in same paginated format

- [ ] Task 5: New Applications Badge
  - [ ] Add method: getNewApplicationCount(UUID bankId)
    - Count applications where status = SUBMITTED and offer from bankId exists
    - Return count to include in queue response header

- [ ] Task 6: Unit Tests
  - [ ] Test filtering by status
  - [ ] Test filtering by loan type, date range, amount range
  - [ ] Test sorting options
  - [ ] Test pagination (page 0, page 1, etc.)
  - [ ] Test search by ID, email, name
  - [ ] Test new applications badge count

- [ ] Task 7: Integration Tests
  - [ ] Create 50+ applications for bank
  - [ ] Verify pagination returns 20 items per page
  - [ ] Verify filters work correctly
  - [ ] Verify performance <200ms with 500+ applications
  - [ ] Verify search returns correct results

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Initial story draft - Application Queue Dashboard | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*To be completed by development agent*

### Debug Log References
*To be completed by development agent*

### Completion Notes
*To be completed by development agent*

### File List
*To be completed by development agent*

## QA Results

*To be completed by QA agent after story is implemented*
