<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ComplianceController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Credit Application Platform</a> &gt; <a href="index.source.html" class="el_package">com.creditapp.compliance.controller</a> &gt; <span class="el_source">ComplianceController.java</span></div><h1>ComplianceController.java</h1><pre class="source lang-java linenums">package com.creditapp.compliance.controller;

import com.creditapp.shared.dto.AuditLogDTO;
import com.creditapp.shared.model.AuditLog;
import com.creditapp.shared.service.AuditService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

/**
 * REST Controller for compliance officers to query audit logs
 * Access restricted to COMPLIANCE_OFFICER role
 */
@RestController
@RequestMapping(&quot;/api/compliance&quot;)
@RequiredArgsConstructor
public class ComplianceController {

    private final AuditService auditService;

    /**
     * Get audit logs for a specific entity
     * GET /api/compliance/audit-logs?entityType=Application&amp;entityId=uuid
     */
    @GetMapping(&quot;/audit-logs&quot;)
    @PreAuthorize(&quot;hasRole('COMPLIANCE_OFFICER')&quot;)
    public ResponseEntity&lt;List&lt;AuditLogDTO&gt;&gt; getAuditLogs(
            @RequestParam String entityType,
            @RequestParam UUID entityId) {
<span class="nc" id="L35">        List&lt;AuditLog&gt; auditLogs = auditService.getAuditLogsForEntity(entityType, entityId);</span>
<span class="nc" id="L36">        List&lt;AuditLogDTO&gt; dtos = auditLogs.stream()</span>
<span class="nc" id="L37">                .map(this::convertToDTO)</span>
<span class="nc" id="L38">                .collect(Collectors.toList());</span>
<span class="nc" id="L39">        return ResponseEntity.ok(dtos);</span>
    }

    /**
     * Get audit logs by actor
     * GET /api/compliance/audit-logs/actor?actorId=uuid
     */
    @GetMapping(&quot;/audit-logs/actor&quot;)
    @PreAuthorize(&quot;hasRole('COMPLIANCE_OFFICER')&quot;)
    public ResponseEntity&lt;List&lt;AuditLogDTO&gt;&gt; getAuditLogsByActor(
            @RequestParam UUID actorId) {
<span class="nc" id="L50">        List&lt;AuditLog&gt; auditLogs = auditService.getAuditLogsByActor(actorId);</span>
<span class="nc" id="L51">        List&lt;AuditLogDTO&gt; dtos = auditLogs.stream()</span>
<span class="nc" id="L52">                .map(this::convertToDTO)</span>
<span class="nc" id="L53">                .collect(Collectors.toList());</span>
<span class="nc" id="L54">        return ResponseEntity.ok(dtos);</span>
    }

    /**
     * Convert AuditLog entity to DTO (excludes sensitive fields)
     */
    private AuditLogDTO convertToDTO(AuditLog auditLog) {
<span class="nc" id="L61">        return new AuditLogDTO(</span>
<span class="nc" id="L62">                auditLog.getId(),</span>
<span class="nc" id="L63">                auditLog.getEntityType(),</span>
<span class="nc" id="L64">                auditLog.getEntityId(),</span>
<span class="nc" id="L65">                auditLog.getAction(),</span>
<span class="nc" id="L66">                auditLog.getActorId(),</span>
<span class="nc" id="L67">                auditLog.getActorRole(),</span>
<span class="nc" id="L68">                auditLog.getOldValues(),</span>
<span class="nc" id="L69">                auditLog.getNewValues(),</span>
<span class="nc" id="L70">                auditLog.getCreatedAt()</span>
        );
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>